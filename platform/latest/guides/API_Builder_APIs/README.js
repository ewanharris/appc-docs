Ext.data.JsonP['API_Builder_APIs']({"guide":" <!doctype html> <html> <head> <title>API Builder APIs</title> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"> </meta></head> <body> <div class=\"container\"> <div class=\"header\"/> <div id=\"src-49153263\" class=\"content\"> <h1>API Builder APIs</h1> <p> </p> <ul class=\"toc-indentation\"><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_APIs-section-src-49153263_APIBuilderAPIs-Introduction\">Introduction</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_APIs-section-src-49153263_APIBuilderAPIs-APIendpointdefinition\">API endpoint definition</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_APIs-section-src-49153263_APIBuilderAPIs-APIexample\">API example</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_APIs-section-src-49153263_APIBuilderAPIs-InvokeAPIendpointsinAPIBuilder\">Invoke API endpoints in API Builder</a> </p> </li></ul> <div class=\"section section-2\" id=\"src-49153263_APIBuilderAPIs-Introduction\"> <h2 class=\"heading\"><span>Introduction</span></h2> <p>This chapter covers the basics for creating API endpoints. API endpoints are automatically generated for all models, but there may be cases where you will want to create your own custom API. </p> <p>An API provides a way for a client to access your application, such as <tt>GET &lt;SERVER_ADDRESS&gt;/api/users/query</tt>, execute custom logic and internally access the application&apos;s models and APIs, then return data back to the client application. </p> <p>To programmatically create an API, see the <a class=\"external-link external-link\" href=\"#!/api/Arrow.API\">API Builder.API</a> reference. </p> </div> <div class=\"section section-2\" id=\"src-49153263_APIBuilderAPIs-APIendpointdefinition\"> <h2 class=\"heading\"><span>API endpoint definition</span></h2> <p>Place all API definition files in the project&apos;s <tt>apis</tt> folder. You can only declare one endpoint definition per file. An API definition file is a JavaScript file, which: </p> <ol class=\"\"><li class=\"\"> <p>Loads the <tt>arrow</tt> module. </p> </li><li class=\"\"> <p>Calls the module&apos;s <tt>API.extend()</tt> method, passing in an object defining the API endpoint and logic. </p> </li><li class=\"\"> <p>Exports the defined endpoint using the <tt>module.exports</tt> variable. </p> </li></ol> <p>Set the following keys in the object passed to the <tt>API.extend()</tt> method to define the API endpoint: </p> <div class=\"tablewrap\"> <table class=\"confluenceTable\"> <thead> <tr> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Name </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Required </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Description </p> </td> </tr> </thead><tfoot class=\"\"/><tbody> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>group </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The logical name for grouping API endpoints. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>path </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Request path (e.g., &#x2018;/api/user/:id&#x2019;). Prefix parameters with a colon (<tt>:</tt>). </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>method </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>HTTP verb (&#x2018;GET&#x2019;, &#x2018;POST&#x2019;, &#x2018;PUT&#x2019;, or &#x2018;DELETE&#x2019;). </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>description </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Description of the endpoint, which is used in the generation of the API endpoint documentation. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>model </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The model to use for the response. An API endpoint can only specify <strong>one</strong> model, but models can be composed of other models and fields. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>action </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>true </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The function that is called to execute the API endpoint&#x2019;s logic. The function is passed a <tt class=\"\">request</tt> object, response object, and <tt class=\"\">next()</tt> method. Use this function to make programmatic calls to your model&#x2019;s methods for reading or writing data and to do other things related to the custom business logic of your API endpoint including making calls to other flow-node modules that your API endpoint requires. You should always make sure that your <tt class=\"\">action</tt> function calls the <tt>next</tt> function regardless if the result is a success or an error. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>documented </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><strong>Since Release 5.0.0.</strong> Determines whether to generate API documentation (true) or not (false). The default setting is true. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>response </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The response model for the API. This should only be used if your request and response models are different. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>plural </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>A string used as the property name when your API endpoint returns an array. By default, the plural value is the plural of the model name. For example, if your model is named <strong class=\"\">car</strong>, the default plural would be <strong>cars</strong>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>singular </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>A string used as the property name when your API endpoint returns a single record. By default, the singular value is the name of the model. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>before </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>One or more API Builder Blocks to be executed before the request. Blocks are referenced by their <tt>name</tt> property. If you want to execute multiple blocks, you should specify them as an array of block names. If multiple blocks are specified, they are executed in the order specified. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>after </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>One or more API Builder Blocks to be executed after the request. Blocks are referenced by their <tt>name</tt> property. If you want to execute multiple blocks, you should specify them as an array of block names. If multiple blocks are specified, they are executed in the order specified. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>parameters </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>false </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Input parameters required to execute the API endpoint. This is an object of key-value pairs, where the key is the name of the parameter and the value is an object with the following properties: </p> <ul class=\"\"><li class=\"\"> <p><tt>optional</tt> (Boolean): Determines if the parameter is optional (true) or required (false). </p> </li><li class=\"\"> <p><tt>type</tt> (String): the type of input parameter: &#x2018;path&#x2019;, &#x2018;query&#x2019;, or &apos;body&apos;. </p> </li><li class=\"\"> <p><tt>description</tt> (String): used for generating API documentation. </p> </li></ul> </td> </tr> </tbody> </table> </div> </div> <div class=\"section section-2\" id=\"src-49153263_APIBuilderAPIs-APIexample\"> <h2 class=\"heading\"><span>API example</span></h2> <p>The following API definition file creates an endpoint that can be accessed by a client using <tt class=\"\">GET &lt;HOST_ADDRESS&gt;/api/test/:id</tt>. Before the request is initiated by the server, the <tt class=\"\">formatRequestBlock</tt> is executed, then the server performs the request (executes the action logic). The action logic tries to find the user model with the specified ID. After the logic executes, the <tt class=\"\">cachingBlock</tt> and <tt>analyticsBlocks</tt> are executed. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">apis/test.js</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"apis/test.js\"> <div class=\"line\"><code class=\"plain\">var Arrow = require(</code><code class=\"string\">&apos;arrow&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">var TestAPI = Arrow.API.extend({</code></div> <div class=\"line\"><code class=\"plain\"> group: </code><code class=\"string\">&apos;test&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> path: </code><code class=\"string\">&apos;/api/test/:id&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> method: </code><code class=\"string\">&apos;GET&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> description: </code><code class=\"string\">&apos;this is an api that shows how to implement an API&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> model: </code><code class=\"string\">&apos;user&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> before: </code><code class=\"string\">&apos;formatRequestBlock&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> after: [</code><code class=\"string\">&apos;cachingBlock&apos;</code><code class=\"plain\">, </code><code class=\"string\">&apos;analyticsBlock&apos;</code><code class=\"plain\">],</code></div> <div class=\"line\"><code class=\"plain\"> parameters: {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"comments\">// &apos;id&apos; is required to execute this endpoint</code></div> <div class=\"line\"><code class=\"plain\"> id: {description:</code><code class=\"string\">&apos;the user id&apos;</code><code class=\"plain\">}</code></div> <div class=\"line\"><code class=\"plain\"> },</code></div> <div class=\"line\"><code class=\"plain\"> action: function (req, res, next) {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"comments\">// call the &apos;find&apos; method on our model to get the data passing the incoming path value id</code></div> <div class=\"line\"><code class=\"plain\"> res.stream(req.model.find, req.params.id, next);</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">});</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">module.exports = TestAPI;</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153263_APIBuilderAPIs-InvokeAPIendpointsinAPIBuilder\"> <h2 class=\"heading\"><span>Invoke API endpoints in API Builder</span></h2> <p>Any callback in the application that is passed the <tt>request</tt> object can access the endpoints programmatically. </p> <p>To invoke an API endpoint: </p> <ol class=\"\"><li class=\"\"> <p>Retrieve an instance to API Builder using the <tt>request.server</tt> property. </p> </li><li class=\"\"> <p>Retrieve the API instance using API Builder&apos;s <tt>getAPI(&apos;endpoint&apos;, &apos;verb&apos;)</tt> method by passing it the endpoint without the server host or address as the first parameter and the HTTP verb as the second parameter. </p> </li><li class=\"\"> <p>Invoke the <tt class=\"\">execute(params, callback)</tt> method on the API instance by passing it a dictionary of parameters as the first parameter and a callback function as the second parameter. The callback function is passed an <tt class=\"\">error</tt> and <tt>results</tt> object. </p> </li></ol> <p><strong>Example:</strong> </p> <p>The Route below is invoking the <tt>GET &lt;SERVER_ADDRESS&gt;/api/car</tt> method programmatically. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">web/routes/testroute.js</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"web/routes/testroute.js\"> <div class=\"line\"><code class=\"plain\">var TestRoute = Arrow.Router.extend({</code></div> <div class=\"line\"><code class=\"plain\"> name: </code><code class=\"string\">&apos;car&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> path: </code><code class=\"string\">&apos;/car&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> method: </code><code class=\"string\">&apos;GET&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> description: </code><code class=\"string\">&apos;get some cars&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> action: function (req, res, next) {</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\"> req.server.getAPI(</code><code class=\"string\">&apos;api/car&apos;</code><code class=\"plain\">, </code><code class=\"string\">&apos;GET&apos;</code><code class=\"plain\">).execute({}, function(err, results) {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"keyword\">if</code><code class=\"plain\"> (err) {</code></div> <div class=\"line\"><code class=\"plain\"> next(err);</code></div> <div class=\"line\"><code class=\"plain\"> } </code><code class=\"keyword\">else</code><code class=\"plain\"> {</code></div> <div class=\"line\"><code class=\"plain\"> req.log.info(</code><code class=\"string\">&apos;got cars &apos;</code><code class=\"plain\"> + JSON.stringify(results));</code></div> <div class=\"line\"><code class=\"plain\"> res.render(</code><code class=\"string\">&apos;car&apos;</code><code class=\"plain\">, results);</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\"> });</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">});</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">module.exports = TestRoute;</code></div> </div> </div> </div> </div><a id=\"editButton\" href=\"https://wiki.appcelerator.org/pages/editpage.action?pageId=49153263\"><span>Edit</span></a> </div> </body> </html> ","title":"API Builder APIs"});