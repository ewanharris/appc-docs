Ext.data.JsonP['API_Builder_Project']({"guide":" <!doctype html> <html> <head> <title>API Builder Project</title> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"> </meta></head> <body> <div class=\"container\"> <div class=\"header\"/> <div id=\"src-49153285\" class=\"content\"> <h1>API Builder Project</h1> <p> </p> <ul class=\"toc-indentation\"><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Overview\">Overview</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Projectstructure\">Project structure</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Initializerfile\">Initializer file</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Deploytheapplication\">Deploy the application</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Logoutput\">Log output</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Viewlogfiles\">View log files</a> </p> <ul class=\"toc-indentation\"><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Loggingutilities\">Logging utilities</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Aboutloggedexecutiontimes\">About logged execution times</a> </p> </li></ul></li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Node.jsversion\">Node.js version</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Portbinding\">Port binding</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Installcustombinaries\">Install custom binaries</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Declaredependencies\">Declare dependencies</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Defineenvironmentvariables\">Define environment variables</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Scaletheapplication\">Scale the application </a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Accessaspecificcontainer\">Access a specific container</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Customdomains\">Custom domains</a> </p> <ul class=\"toc-indentation\"><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Setacustomdomainandpath\">Set a custom domain and path</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Wildcardsubdomains\">Wildcard subdomains</a> </p> </li></ul></li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-AddacustomSSLcertificate\">Add a custom SSL certificate</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Createchildprocesses\">Create child processes</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Applicationlimitations\">Application limitations</a> </p> <ul class=\"toc-indentation\"><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Diskspace\">Disk space</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-ServercontainersServercontainers\">Server containers</a> </p> </li><li class=\"\"> <p><a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Serverports\">Server ports</a> </p> </li></ul></li></ul> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Overview\"> <h2 class=\"heading\"><span>Overview</span></h2> <p>An API Builder application is a standard Node.js application that runs in the API Runtime Services environment. This guide covers how to manage your project. </p> <div class=\"confbox admonition admonition-info aui-message hint shadowed information-macro\"> <p>You may also use Appcelerator Studio to manage your API Builder (formerly known as Arrow Builder) projects. For details, see <a class=\"document-link\" href=\"#!/guide/API_Builder_Development\">API Builder Development</a>. </p> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Projectstructure\"> <h2 class=\"heading\"><span>Project structure</span></h2> <p>A project is made up of several components. To simplify development, API Builder primarily uses a strict directory structure and naming convention to organize the application rather than configuration files. </p> <p>The following is a list of directories and files that can be found in a project: </p> <div class=\"tablewrap\"> <table class=\"confluenceTable\"> <thead> <tr> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>File/Folder Name </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Description </p> </td> </tr> </thead><tfoot class=\"\"/><tbody> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>apis</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains API JavaScript files, used to create custom entry points for the application. For details, see <a class=\"document-link\" href=\"#!/guide/API_Builder_APIs\">API Builder APIs</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>app.js</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The entry point to the application if it is used as a server. You can monitor the startup and shutdown sequence. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>appc.json</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains component dependencies and API Runtime Services deployment settings. For details, see <a class=\"document-link\" href=\"#!/guide/API_Runtime_Configuration\">API Runtime Configuration</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>blocks</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Block JavaScript files, used to create pre- and post-processing filters. For details, see <a class=\"document-link\" href=\"#!/guide/API_Builder_Blocks\">API Builder Blocks</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <pre>codeblocks</pre> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Codeblock, JSON, and Javascript files, used for defining custom functions for use in Flows. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>conf</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains configuration files in JSON format for the project and required connectors. For details, see <a class=\"document-link\" href=\"#!/guide/Console_Configuration\">Console Configuration</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>docs</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains generated docs for your project&apos;s APIs. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <pre>endpoints</pre> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Endpoint JSON files, these are OpenAPI 2.0 (Swagger) documents used to create custom entry points for the application, with execution logic defined by linked Flows </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <pre>flows</pre> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Flow JSON files, used for defining business logic for Endpoints. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>index.js</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>The entry point to the application if it is used as a module. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>logs</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains generated log files when running your project locally. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>models</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Model JavaScript files, used to define the schema for your data. For details, see <a class=\"document-link\" href=\"#!/guide/Models\">Models</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>node_modules</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains project dependencies. API Builder automatically installs any project dependencies declared in the <tt>package.json</tt> file. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>nodes</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains custom flow-nodes for use in Flows. Flow-nodes must be Node.js packages in their own folders named <tt>nodehandler-*</tt>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>package.json</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>NPM configuration file to declare project dependencies and other build or runtime configurations. For details, see <a class=\"document-link\" href=\"#!/guide/NodeJS_Configuration\">NodeJS Configuration</a>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>package-lock.json</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>NPM configuration file that is generated when NPM modifies either the <tt class=\"\">node_modules</tt> tree or the <tt class=\"\">package.json</tt> file. It describes the exact tree that was generated so that subsequent installs are able to generate identical trees, regardless of intermediate dependency updates. The <tt class=\"\">npm shrinkwrap</tt> command repurposes the <tt class=\"\">package-lock.json</tt> file into a publishable <tt class=\"\">npm-shrinkwrap.json</tt> file. For additional information on shrink wrapping a project, refer to <tt>npm shrinkwrap</tt>. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>serviceconnectors</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains installed service connectors used within Flows for connecting to and interacting with external services. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>web</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Web files, used to create endpoints that render UI. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>web/public</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains static assets, such as CSS, HTML, image, or JavaScript files, for your Web interface. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>web/routes</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains Route JavaScript files, used to define the API endpoint and logic for your Web interface. </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p><tt>web/views</tt> </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Contains template files for your Web interface. Files must have one of the following extensions: <tt class=\"\">ejs</tt>, <tt class=\"\">hbs</tt>, <tt class=\"\">md,</tt> or <tt>jsx</tt>. </p> </td> </tr> </tbody> </table> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Initializerfile\"> <h2 class=\"heading\"><span>Initializer file</span></h2> <p>The <tt>app.js</tt> file contains code that initializes the server instance. You can hook into the lifecycle events of the server as well as make additional setup or middleware calls to the server or Express app instance. </p> <p>For example, the following <tt>server.app.use</tt> call forces the client to use a secure connection by redirecting any unsecured connections to the HTTPS URL. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">app.js</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"app.js\"> <div class=\"line\"><code class=\"plain\">var Arrow = require(</code><code class=\"string\">&apos;arrow&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">var server = </code><code class=\"keyword\">new</code><code class=\"plain\"> Arrow();</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">server.on(</code><code class=\"string\">&apos;starting&apos;</code><code class=\"plain\">, function () {</code></div> <div class=\"line\"><code class=\"plain\"> server.logger.debug(</code><code class=\"string\">&apos;server is starting!&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">&#xA0;</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"comments\">// server.app reference the Express app instance</code></div> <div class=\"line\"><code class=\"plain\"> server.app.use(function (req, res, next) {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"keyword\">if</code><code class=\"plain\"> (!req.secure) {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"keyword\">return</code><code class=\"plain\"> res.redirect(</code><code class=\"string\">&apos;https://&apos;</code><code class=\"plain\"> + req.get(</code><code class=\"string\">&apos;Host&apos;</code><code class=\"plain\">) + req.originalUrl);</code></div> <div class=\"line\"><code class=\"plain\"> } </code><code class=\"keyword\">else</code><code class=\"plain\"> {</code></div> <div class=\"line\"><code class=\"plain\"> next();</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\"> });</code></div> <div class=\"line\"><code class=\"plain\">});</code></div> <div class=\"line\"><code class=\"comments\">// start the server</code></div> <div class=\"line\"><code class=\"plain\">server.start();</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Deploytheapplication\"> <h2 class=\"heading\"><span>Deploy the application</span></h2> <p>To deploy an application to API Runtime Services, run the <tt class=\"\">appc publish</tt> command from the API Runtime Services project directory. Your project source code will be uploaded to the API Runtime Services where <tt class=\"\">npm install</tt> will be executed against the project, which downloads and installs any NPM module dependencies. When the installation completes, the application is executed using <tt>node</tt>. </p> <p>If the application is already deployed, you need to either increment the <tt class=\"\">version</tt> field in the <tt class=\"\">package.json</tt> file to publish a new version of the application or pass the <tt class=\"\">--force</tt> flag to the publish command to republish the application. Before republishing the application, API Runtime Services sends the <tt>SIGTERM</tt> signal to the currently deployed application to let it shutdown gracefully. If the app does not shut down in time, API Runtime Services will kill the application. </p> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Logoutput\"> <h2 class=\"heading\"><span>Log output</span></h2> <p>API Runtime Services can capture two kinds of log output from applications: </p> <ul class=\"\"><li> <p>access logs &#x2013; HTTP requests to the application </p> </li><li> <p>application logs &#x2013; explicit log calls made in the application </p> </li></ul> <p>To capture access logs, use the <tt class=\"\">appc-logger</tt> module, and to capture application logs, you can either use the standard JavaScript <tt class=\"\">console.log()</tt> and <tt class=\"\">console.error()</tt> methods, or you can use the <tt>appc-logger</tt> module. </p> <p>By default, when an application is initialized, it loads and creates an <tt class=\"\">appc-logger</tt> instance. The <tt>appc-logger</tt> instance is bound to the server instance, which will automatically capture access logs for the application. </p> <p>To make log calls, use the <tt class=\"\">logger</tt> property from either the API Builder instance, request object or response object to invoke <a class=\"external-link external-link\" href=\"#!/api/Arrow.Logger\"> <tt>appc-logger</tt> APIs</a>. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"keyword\">var</code><code class=\"plain\"> Arrow = require(</code><code class=\"string\">&apos;arrow&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"keyword\">var</code><code class=\"plain\"> TestAPI = Arrow.API.extend({</code></div> <div class=\"line\"><code class=\"plain\"> group: </code><code class=\"string\">&apos;ping&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> path: </code><code class=\"string\">&apos;/healthCheck&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> method: </code><code class=\"string\">&apos;GET&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> description: </code><code class=\"string\">&apos;Health-check endpoint&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> action: </code><code class=\"keyword\">function</code><code class=\"plain\"> (req, res, next) {</code></div> <div class=\"line\"><code class=\"plain\"> req.logger.info(</code><code class=\"string\">&apos;ping&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\"> res.status(200).send(</code><code class=\"string\">&apos;OK&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\"> res.logger.info(</code><code class=\"string\">&apos;pong&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\"> next();</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">});</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">module.exports = TestAPI;</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Viewlogfiles\"> <h2 class=\"heading\"><span>View log files</span></h2> <p>An application typically runs in the cloud, so being able to see what is happening in the application is very important. Any log output written to <tt class=\"\">stdout</tt> or <tt class=\"\">stderr</tt> in the application&apos;s root process is captured and stored by API Runtime Services, and can be viewed using the Appcelerator command-line tool or in the <strong>Logs</strong> tab of the Dashboard. </p> <p><strong>Notes:</strong> </p> <ul class=\"\"><li> <p>Only output written by the application&apos;s root process is included in the log file; output written by child processes forked by the application&apos;s root process will not be caught. </p> </li><li> <p>Errors such as syntax errors, application crashes, and system level failures are logged automatically. </p> </li></ul> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Loggingutilities\"> <h3 class=\"heading\"><span>Logging utilities</span></h3> <p>The Appcelerator CLI provides three commands for viewing logs for a published application: <strong class=\"\">accesslog</strong>, <strong class=\"\">logcat</strong>, and <strong>loglist</strong>. </p> <ul class=\"\"><li class=\"\"> <p>The <tt>appc cloud accesslog</tt> command lists all requests processed by the Appcelerator Cloud in a specified time period. By default, a maximum of 100 log messages is returned at a time. </p> </li><li class=\"\"> <p>The <tt>appc cloud loglist</tt> command lists your published application&apos;s log for a specific period. By default, a maximum of 100 log messages is returned at a time. </p> </li><li class=\"\"> <p>The <tt>appc cloud logcat</tt> command lists your published application&apos;s log continuously from Appcelerator Cloud. </p> </li></ul> </div> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Aboutloggedexecutiontimes\"> <h3 class=\"heading\"><span>About logged execution times</span></h3> <p>The execution time reported by the <tt class=\"\">loglist</tt> and <tt class=\"\">accesslog</tt> commands report slightly different values. The <tt class=\"\">accesslog</tt> command reports the time required by Appcelerator Cloud to handle the initial user request, pass it to your Node.js application for processing, and deliver the response. In contrast, <tt class=\"\">loglist</tt> only reports the execution time for your application itself, not including the time required to process the request and response. Consequently, the <tt class=\"\">accesslog</tt> execution times are a slightly longer than those of the corresponding <tt class=\"\">loglist</tt> log item. For instance, below is <tt>accesslog</tt> output: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">[</code><code class=\"value\">12</code><code class=\"plain\">/</code><code class=\"value\">11</code><code class=\"plain\">/</code><code class=\"value\">2013</code><code class=\"plain\"> </code><code class=\"value\">08</code><code class=\"plain\">:</code><code class=\"value\">43</code><code class=\"plain\">:</code><code class=\"value\">55.790</code><code class=\"plain\">] </code><code class=\"value\">127.0</code><code class=\"plain\">.</code><code class=\"value\">0.1</code><code class=\"plain\"> / 10074ms</code></div> <div class=\"line\"><code class=\"plain\">[</code><code class=\"value\">12</code><code class=\"plain\">/</code><code class=\"value\">11</code><code class=\"plain\">/</code><code class=\"value\">2013</code><code class=\"plain\"> </code><code class=\"value\">08</code><code class=\"plain\">:</code><code class=\"value\">43</code><code class=\"plain\">:</code><code class=\"value\">23.712</code><code class=\"plain\">] </code><code class=\"value\">127.0</code><code class=\"plain\">.</code><code class=\"value\">0.1</code><code class=\"plain\"> / 10073ms</code></div> <div class=\"line\"><code class=\"plain\">[</code><code class=\"value\">12</code><code class=\"plain\">/</code><code class=\"value\">11</code><code class=\"plain\">/</code><code class=\"value\">2013</code><code class=\"plain\"> </code><code class=\"value\">08</code><code class=\"plain\">:</code><code class=\"value\">43</code><code class=\"plain\">:</code><code class=\"value\">07.237</code><code class=\"plain\">] </code><code class=\"value\">127.0</code><code class=\"plain\">.</code><code class=\"value\">0.1</code><code class=\"plain\"> / 10073ms</code></div> <div class=\"line\"><code class=\"plain\">[</code><code class=\"value\">12</code><code class=\"plain\">/</code><code class=\"value\">11</code><code class=\"plain\">/</code><code class=\"value\">2013</code><code class=\"plain\"> </code><code class=\"value\">08</code><code class=\"plain\">:</code><code class=\"value\">42</code><code class=\"plain\">:</code><code class=\"value\">48.365</code><code class=\"plain\">] </code><code class=\"value\">127.0</code><code class=\"plain\">.</code><code class=\"value\">0.1</code><code class=\"plain\"> / 10075ms</code></div> </div> </div> <p>And below is the corresponding <tt>loglist</tt> output. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"value\">12</code><code class=\"plain\">/</code><code class=\"value\">11</code><code class=\"plain\">/</code><code class=\"value\">2013</code><code class=\"plain\"> </code><code class=\"value\">16</code><code class=\"plain\">:</code><code class=\"value\">42</code><code class=\"plain\">:</code><code class=\"value\">028.139</code><code class=\"plain\"> [INFO] [</code><code class=\"value\">43210</code><code class=\"plain\">] App started</code></div> <div class=\"line\"><code class=\"plain\">[PERF] GET / </code><code class=\"value\">10069</code><code class=\"plain\"> ms</code></div> <div class=\"line\"><code class=\"plain\">[PERF] GET / </code><code class=\"value\">10072</code><code class=\"plain\"> ms</code></div> <div class=\"line\"><code class=\"plain\">[PERF] GET / </code><code class=\"value\">10072</code><code class=\"plain\"> ms</code></div> <div class=\"line\"><code class=\"plain\">[PERF] GET / </code><code class=\"value\">10066</code><code class=\"plain\"> ms</code></div> </div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Node.jsversion\"> <h2 class=\"heading\"><span>Node.js version</span></h2> <p>Prior to API Runtime Services (formerly known as Arrow Cloud) 1.2.0, the only Node.js versions you could use were 0.8.26 and 0.10.22. </p> <p>Starting with API Runtime Services 1.2.0, you may specify any version of Node.js. Node.js 0.8.26, 0.10.22 and 0.12.4 are built in, but other versions will be downloaded from <a class=\"external-link external-link\" href=\"https://nodejs.org/\" target=\"_blank\">https://nodejs.org/</a> when the application is built prior to running <tt>npm install</tt>. </p> <p>To specify a Node.js version, in the <tt class=\"\">package.json</tt> file, set the <tt>engines.node</tt> key to the version of Node.js you want to use. DO NOT SPECIFY A RANGE. If you do not specify a Node.js version, the application will use 4.4.7 by default (as of SDK 6.0.0). </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">package.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"package.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"string\">&quot;engines&quot;</code><code class=\"plain\">: {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"string\">&quot;node&quot;</code><code class=\"plain\">: </code><code class=\"string\">&quot;0.12.4&quot;</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Portbinding\"> <h2 class=\"heading\"><span>Port binding</span></h2> <p>Starting with API Runtime Services 1.2.0, you may explicitly set the port the application listens on. Set the <tt class=\"\">cloud.environment.PORT</tt> key in the <tt class=\"\">appc.json</tt> file. or use the <tt>appc cloud config --set &quot;PORT=&lt;PORT_NUMBER&gt;&quot;</tt> command to set the special environment variable PORT. If you do not set PORT explicitly before publishing your application, API Runtime Services sets it to 80 by default. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">appc.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"appc.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> cloud: {</code></div> <div class=\"line\"><code class=\"plain\"> environment: {</code></div> <div class=\"line\"><code class=\"plain\"> PORT: </code><code class=\"value\">8080</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> <p>Verify that the application listens on PORT, otherwise your app cannot be connected. Use <tt>process.env.PORT</tt> in the application to verify the application is connected to a port. </p> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Installcustombinaries\"> <h2 class=\"heading\"><span>Install custom binaries</span></h2> <p>API Runtime Services allows you to install additional binaries before your application is built. </p> <p>Starting with API Runtime Services 1.3.0, to install additional third-party tools, create a script called <tt>install.sh</tt> in the project&apos;s root folder, which installs the required packages. </p> <div class=\"confbox admonition admonition-info aui-message hint shadowed information-macro\"> <div class=\"title\">ImageMagick and PhantomJS</div> <p>Both ImageMagick and PhantomJS are pre-installed on the containers. </p> </div> <p>Below is a sample script located in the <tt>./install.sh</tt> folder in the application&apos;s directory. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">install.sh</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"install.sh\"> <div class=\"line\"><code class=\"comments\">#!/bin/bash</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;---&quot;</code></div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;Start installing some tools...&quot;</code></div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;(This bash script is run at npm preinstall.)&quot;</code></div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;---&quot;</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">apt-get </code><code class=\"functions\">install</code><code class=\"plain\"> -qq </code><code class=\"functions\">tar</code><code class=\"plain\"> </code><code class=\"functions\">bzip2</code><code class=\"plain\"> libaio1</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">apt-get </code><code class=\"functions\">install</code><code class=\"plain\"> -y wget</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;---&quot;</code></div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;done installing additional tools!&quot;</code></div> <div class=\"line\"><code class=\"functions\">echo</code><code class=\"plain\"> </code><code class=\"string\">&quot;---&quot;</code></div> </div> </div> <p>Prior to Release 1.3.0, you needed to create a script in your project folder (no name restrictions) and add the script to the <tt class=\"\">package.json</tt> file. In the <tt class=\"\">package.json</tt> file, set the <tt class=\"\">scripts.preinstall</tt> or <tt>scripts.postinstall</tt> field to the path to the script: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">package.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"package.json\"> <div class=\"line\"><code class=\"plain\"> </code><code class=\"string\">&quot;scripts&quot;</code><code class=\"plain\">: {</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"string\">&quot;preinstall&quot;</code><code class=\"plain\">: </code><code class=\"string\">&quot;myscript.sh&quot;</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> </div> </div> <p>Note that from API Runtime Services 1.3.0 and later, you can still use the above method but do not name the script <tt>install.sh</tt> or it will run twice, and only install the binaries in the project directory. Prior to API Runtime Services 1.3.0, binaries could be installed outside the project directory. </p> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Declaredependencies\"> <h2 class=\"heading\"><span>Declare dependencies</span></h2> <p>The application can import any third-party modules that are supported by standard Node.js applications. Before publishing the app to the cloud, make sure all dependencies are listed in the <tt class=\"\">dependencies</tt> field in the application&apos;s <tt>package.json</tt> file. For example, to add support for MongoDB 1.2.0 or greater: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">package.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"package.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> </code><code class=\"string\">&quot;dependencies&quot;</code><code class=\"plain\">:{ </code><code class=\"string\">&quot;mongodb&quot;</code><code class=\"plain\">: </code><code class=\"string\">&quot;&gt;1.2.0&quot;</code><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Defineenvironmentvariables\"> <h2 class=\"heading\"><span>Define environment variables</span></h2> <p>To set environment variables, add them to the <tt class=\"\">cloud.environment</tt> object in the project&apos;s <tt>appc.json</tt> file. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">appc.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"appc.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> cloud: {</code></div> <div class=\"line\"><code class=\"plain\"> environment: {</code></div> <div class=\"line\"><code class=\"plain\"> foo: </code><code class=\"string\">&apos;abc&apos;</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> <p>You can also use the Appcelerator CLI to manage the environment variables. </p> <p>To set environment variables, use the <tt>appc cloud config --set &lt;key&gt;=&lt;value&gt;</tt> command. To set more than one variable at a time, comma-separate the key-value pairs. </p> <p>You can access the environment variables from the application using the <tt class=\"\">process.env</tt> namespace. For example, if you set a variable called <tt class=\"\">foo</tt>, use <tt>process.env.foo</tt> to access it in the application. </p> <p>To unset an environment variable, use the <tt>appc cloud config --unset &lt;key&gt;</tt> command. </p> <p>To check the current environment variables, use the <tt> appc cloud config --env</tt> command. </p> <div class=\"confbox admonition admonition-info aui-message hint shadowed information-macro\"> <div class=\"title\">Blacklist Variable Names</div> <p>Prior to API Runtime Services 1.2.0, you could not use the following names for environment variables: &quot;appid&quot;, &quot;basedir&quot;, &quot;bodyParser&quot;, &quot;customConfig&quot;, &quot;dirname&quot;, &quot;framework&quot;, &quot;fullpath&quot;, &quot;name&quot;, &quot;serverId&quot;, &quot;port&quot;, &quot;version&quot;, &quot;NODE&quot;, &quot;NODE_PATH&quot;, &quot;PATH&quot;, &quot;PWD&quot;, &quot;PORT&quot;, &quot;TMPDIR&quot;, and &quot;USER&quot;. </p> </div> <p>After changing an environment variable, you will be prompted to restart the application. </p> <p> <span style=\"color: #222222;\"> The following example sets the </span> <tt>foo</tt> <span style=\"color: #222222;\"> environment variables, lists all set environment variables, then unsets the </span> <tt>foo</tt> <span style=\"color: #222222;\"> variable: </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">appc cloud config --set foo=abc</code></div> <div class=\"line\"><code class=\"plain\">appc cloud config --env</code></div> <div class=\"line\"><code class=\"plain\">appc cloud config --unset foo</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Scaletheapplication\"> <h2 class=\"heading\"><span>Scale the application</span></h2> <p> <span style=\"color: #222222;\"> To customize the number of cloud servers the application can enable the auto-scaling feature to automatically scale up and down the number of cloud servers based on the number of queued requests. You specify the maximum number of queued requests that should occur before the application is scaled up. API Runtime Services will increase the number of containers if the queue is too high for at least one minute. You can also specify the minimum and the maximum number of servers that should be used. </span> </p> <p> <span style=\"color: #222222;\"> The following example enables autoscaling, using a maximum of five servers when there are at least 20 queued requests. The application is also configured to automatically scale down the number of servers when the number of queued requests drops below 20. </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">appc.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"appc.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> cloud: {</code></div> <div class=\"line\"><code class=\"plain\"> maximum: </code><code class=\"value\">5</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> minimum: </code><code class=\"value\">1</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> maxqueuedrequests: </code><code class=\"value\">20</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> <p> <span style=\"color: #222222;\"> You can also use the </span> <tt>appc cloud config</tt> <span style=\"color: #222222;\"> command to configure autoscaling: </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">appc cloud config --maxsize </code><code class=\"value\">5</code><code class=\"plain\"> MyFirstApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud config --maxqueuedrequests </code><code class=\"value\">20</code><code class=\"plain\"> MyFirstApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud config --autoscaleup </code><code class=\"keyword\">true</code><code class=\"plain\"> MyFirstApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud config --autoscaledown </code><code class=\"keyword\">true</code><code class=\"plain\"> MyFirstApp&#xA0;</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Accessaspecificcontainer\"> <h2 class=\"heading\"><span>Access a specific container</span></h2> <p>Starting with API Runtime Services 1.3.1, if you have scaled your application to use more than one server container, you can make a request to a specific container that your application is running on. To make a request to a specific server container, pass the <tt class=\"\">_serverid</tt> parameter with the request and set it to the ID of the server container. To retrieve the server container ID, run the <tt class=\"\">appc cloud </tt><tt>accesslog --show_serverid</tt> command. </p> <p>Example: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">https:</code><code class=\"comments\">//&lt;APP_GUID&gt;.cloudapp-enterprise.appcelerator.com?_serverid=&lt;SERVER_ID&gt;</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Customdomains\"> <h2 class=\"heading\"><span>Custom domains</span></h2> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Setacustomdomainandpath\"> <h3 class=\"heading\"><span>Set a custom domain and path</span></h3> <p>You can bind a custom domain to your application that points to either a CNAME record or A record as well as assign it a path. When setting the domain, do not specify the protocol, that is, do not prefix the URL with <tt class=\"\">http://</tt> or <tt>https://</tt>. </p> <p>The alias to set should be a valid domain name that has been already configured with either a CNAME or A record pointing to the published application&apos;s URL. Appcelerator Cloud validates the domain record before binding it to the application. </p> <p>To set a custom domain, set the <tt class=\"\">cloud.domain</tt> field in the <tt class=\"\">appc.json</tt> file. You can optionally set the <tt class=\"\">cloud.domainPath</tt> field to assign a path to the application. The following example sets a domain and path on the application that can be accessed from <tt>www.foo.com/v2</tt>: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">appc.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"appc.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> cloud: {</code></div> <div class=\"line\"><code class=\"plain\"> domain: </code><code class=\"string\">&apos;www.foo.com&apos;</code><code class=\"plain\">,</code></div> <div class=\"line\"><code class=\"plain\"> domainPath: </code><code class=\"string\">&apos;v2&apos;</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> <div class=\"line\"><code class=\"plain\">&#xA0;</code></div> </div> </div> <p>You can also use the Appcelerator CLI to manage the domain and path. </p> <p>To bind a domain to an application, use the <tt class=\"\">appc cloud config --set &lt;domain_name&gt;</tt> command to bind a domain to the application. You can bind multiple domains to an application. Use the <tt>--set &lt;domain_name&gt;</tt> parameter to bind up to five additional domains to the application. </p> <p>If you need to remove a domain, use the <tt class=\"\">--remove</tt> parameter. For applications with multiple domains, you will be prompted to select which domain to remove. You may optionally pass the domain name to remove with the <tt>--remove</tt> parameter. <span style=\"color: #222222;\"> </span> </p> <p>To route, an application based on a path with the domain name, use the <tt>appc cloud config --path &lt;path_name&gt;</tt> command to set a path for the application after setting a domain. For example, if you want to bind two applications to the same domain, specify a path for each to route a client to the correct application. </p> <p> <span style=\"color: #222222;\"> The following example allows the application to be accessed from </span> <tt>www.foo.com</tt> <span style=\"color: #222222;\"> : </span> <span style=\"color: #222222;\"> </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">appc cloud domain --set www.foo.com</code></div> </div> </div> <p> <span style=\"color: #222222;\"> The following example allows the LegacyApp application to be accessed from <tt class=\"\">www.foo.com/v1</tt> and the BrandNewApp application to be accessed from <tt>www.foo.com/v2</tt> : </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">appc cloud domain --set www.foo.com LegacyApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud domain --path v1 LegacyApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud domain --set www.foo.com BrandNewApp</code></div> <div class=\"line\"><code class=\"plain\">appc cloud domain --path v2 BrandNewApp</code></div> </div> </div> </div> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Wildcardsubdomains\"> <h3 class=\"heading\"><span>Wildcard subdomains</span></h3> <p>The pre-defined <tt class=\"\">cloudapp.appcelerator.com</tt> URL that Appcelerator Cloud uses to publish your application supports a wildcard subdomain. You may append a token to the beginning of the URL that can be parsed by the application. This does not apply to custom domain names using the <tt>acs domain</tt> command to bind the application to a CNAME or A record. </p> <p>For example, if your published URL is <tt class=\"\">https://1234567890.cloudapp.appcelerator.com/</tt>, you can navigate to your application using the same domain and add a custom token as the subdomain, for example, <tt class=\"\">https://deadbeef.1234567890.cloudapp.appcelerator.com/</tt>, where <tt>deadbeef</tt> is the wildcard subdomain. Then, the application can retrieve the host and subdomain: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">var http = require(</code><code class=\"string\">&apos;http&apos;</code><code class=\"plain\">),</code></div> <div class=\"line\"><code class=\"plain\"> url = require(</code><code class=\"string\">&apos;url&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">http.createServer(function (req, res) {</code></div> <div class=\"line\"><code class=\"plain\"> var host = req.headers[</code><code class=\"string\">&apos;host&apos;</code><code class=\"plain\">],</code></div> <div class=\"line\"><code class=\"plain\"> subdomain = host &amp;&amp; url.parse(</code><code class=\"string\">&apos;http://&apos;</code><code class=\"plain\">+host).hostname.split(</code><code class=\"string\">&apos;.&apos;</code><code class=\"plain\">)[</code><code class=\"value\">0</code><code class=\"plain\">];</code></div> <div class=\"line\"><code class=\"plain\"> res.writeHead(</code><code class=\"value\">200</code><code class=\"plain\">, {</code><code class=\"string\">&apos;Content-Type&apos;</code><code class=\"plain\">: </code><code class=\"string\">&apos;text/plain&apos;</code><code class=\"plain\">});</code></div> <div class=\"line\"><code class=\"plain\"> res.end(</code><code class=\"string\">&apos;Your host is: &apos;</code><code class=\"plain\"> + host + </code><code class=\"string\">&apos;. Subdomain is: &apos;</code><code class=\"plain\"> + subdomain);</code></div> <div class=\"line\"><code class=\"plain\">}).listen(process.env.PORT || </code><code class=\"value\">8080</code><code class=\"plain\">);&#xA0;</code></div> </div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-AddacustomSSLcertificate\"> <h2 class=\"heading\"><span>Add a custom SSL certificate</span></h2> <p>To use a custom SSL certificate to access your application using HTTPS, you need to create a PEM file, then add the PEM file to the application. </p> <p>To create a PEM file, you will need the following three files provided by your SSL certificate provider: </p> <ul class=\"\"><li class=\"\"> <p>Certificate file (<tt>customapp.com.crt</tt>, for example) </p> </li><li class=\"\"> <p>An intermediate certificate authority (<tt>gd_bundle.crt</tt>, for example) </p> </li><li class=\"\"> <p>Key used to generate the certificate (<tt>customapp.com.key</tt>, for example) </p> </li></ul> <p>You need to combine the contents of the three files into a single text file, called a PEM file, which you will add to your application. The PEM file must have the following structure: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">-----BEGIN CERTIFICATE-----</code></div> <div class=\"line\"><code class=\"plain\">&lt;SSL certificate file contents&gt;</code></div> <div class=\"line\"><code class=\"plain\">-----END CERTIFICATE-----</code></div> <div class=\"line\"><code class=\"plain\">-----BEGIN CERTIFICATE-----</code></div> <div class=\"line\"><code class=\"plain\">&lt;Intermediate certificate file contents&gt;</code></div> <div class=\"line\"><code class=\"plain\">-----END CERTIFICATE-----</code></div> <div class=\"line\"><code class=\"plain\">-----BEGIN RSA PRIVATE KEY-----</code></div> <div class=\"line\"><code class=\"plain\">&lt;Private key file contents&gt;</code></div> <div class=\"line\"><code class=\"plain\">-----END RSA PRIVATE KEY----</code></div> </div> </div> <p>Use a text editor or the <tt>cat</tt> command to merge the files together: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">cat customapp.com.crt gd_bundle.crt customapp.com.key &gt; customapp.com.pem</code></div> </div> </div> <p>Once you have created the PEM file, set the <tt>cloud.certificate</tt> field to the path of the certificate file. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">appc.json</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"appc.json\"> <div class=\"line\"><code class=\"plain\">{</code></div> <div class=\"line\"><code class=\"plain\"> cloud: {</code></div> <div class=\"line\"><code class=\"plain\"> certificate: </code><code class=\"string\">&apos;customapp.com.pem&apos;</code></div> <div class=\"line\"><code class=\"plain\"> }</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> <p>You can also add it to your application by executing the following command: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">appc cloud crt --add customapp.com.pem </code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Createchildprocesses\"> <h2 class=\"heading\"><span>Create child processes</span></h2> <p>A single instance of Node.js runs in a single thread. To take advantage of multi-core systems, you can launch a cluster of Node.js processes to handle the load. Applications can use the core Node <a class=\"external-link external-link\" href=\"http://nodejs.org/api/cluster.html\" target=\"_blank\">Cluster</a> module to easily create child processes that all share server ports. </p> <p>To use this feature you application uses <a class=\"external-link external-link\" href=\"http://nodejs.org/api/cluster.html#cluster_cluster_setupmaster_settings\" target=\"_blank\">cluster.setupMaster()</a> to set a path to a custom file to use for each child process. A cluster should listen on port 9000 or greater to avoid port conflicts. If the port your application is trying to listen on is in use, an <tt class=\"\">EADDRINUSE</tt> error will result. Your application must also have privileges to listen on the specified port, otherwise, an <tt>EACCES</tt> error will result. </p> <p><strong>Example</strong>: </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">app.js</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"app.js\"> <div class=\"line\"><code class=\"plain\">var cluster = require(</code><code class=\"string\">&apos;cluster&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">var http = require(</code><code class=\"string\">&apos;http&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">var numCPUs = require(</code><code class=\"string\">&apos;os&apos;</code><code class=\"plain\">).cpus().length;</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">cluster.setupMaster({exec: __dirname + </code><code class=\"string\">&apos;/child.js&apos;</code><code class=\"plain\">});</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"comments\">// Fork workers</code></div> <div class=\"line\"><code class=\"keyword\">for</code><code class=\"plain\"> (var i = </code><code class=\"value\">0</code><code class=\"plain\">; i &lt; numCPUs; i++) {</code></div> <div class=\"line\"><code class=\"plain\"> cluster.fork();</code></div> <div class=\"line\"><code class=\"plain\">}</code></div> </div> </div> <p> <span style=\"color: #222222;\"> </span> </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"title\">child.js</div> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\" data-title=\"child.js\"> <div class=\"line\"><code class=\"plain\">var http = require(</code><code class=\"string\">&apos;http&apos;</code><code class=\"plain\">);</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">console.log(</code><code class=\"string\">&apos;Running in child process of a cluster.&apos;</code><code class=\"plain\">)</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">http.createServer(function(req, res) {</code></div> <div class=\"line\"><code class=\"plain\"> res.writeHead(</code><code class=\"value\">200</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\"> res.end(</code><code class=\"string\">&quot;hello world!!!\\n&quot;</code><code class=\"plain\">);</code></div> <div class=\"line\"><code class=\"plain\">}).listen(</code><code class=\"value\">9000</code><code class=\"plain\">);</code></div> </div> </div> </div> <div class=\"section section-2\" id=\"src-49153285_APIBuilderProject-Applicationlimitations\"> <h2 class=\"heading\"><span>Application limitations</span></h2> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Diskspace\"> <h3 class=\"heading\"><span>Disk space</span></h3> <p>Each application can use 1.8 GB of disk space. The application can only write files to the project&apos;s root directory and to the <tt>/tmp</tt> folder. </p> </div> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-ServercontainersServercontainers\"> <h3 class=\"heading\"><span id=\"src-49153285_APIBuilderProject-Servercontainers\" class=\"confluence-anchor-link\"/><span>Server containers</span></h3> <p>Each application runs in a specific container size with different resources (memory and number of CPUs). By default, when the application is published, it will run in one Medium container. </p> <ul class=\"\"><li class=\"\"> <p>To specify a bigger container for the application, set the <tt class=\"\">cloud.container</tt> field in the <tt class=\"\">appc.json</tt> file or use the <tt>appc cloud server</tt> command. </p> </li><li class=\"\"> <p>To use more than one container for your application, see <a class=\"document-link\" href=\"#!/guide/API_Builder_Project-section-src-49153285_APIBuilderProject-Scaletheapplication\">Scale the Application</a>. </p> </li></ul> <p>You can specify one of the following container sizes depending on your AMPLIFY Appcelerator Services subscription: </p> <div class=\"tablewrap\"> <table class=\"confluenceTable\"> <thead> <tr> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Name </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Point Cost </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Memory </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>CPU Shares </p> </td> <td class=\"confluenceTh\" rowspan=\"1\" colspan=\"1\"> <p>Archive Behavior </p> </td> </tr> </thead><tfoot class=\"\"/><tbody> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Dev </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>1 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>512MB </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>1000 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>After an hour of inactivity </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Small </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>2 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>256MB </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>1000 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>After a week of inactivity </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Medium </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>4 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>512MB </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>2000 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>After a week of inactivity </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>Large </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>8 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>1024MB </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>4000 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>After a week of inactivity </p> </td> </tr> <tr> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>XLarge </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>16 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>2048MB </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>8000 </p> </td> <td class=\"confluenceTd\" rowspan=\"1\" colspan=\"1\"> <p>After a week of inactivity </p> </td> </tr> </tbody> </table> </div> <p> </p> <div class=\"confbox admonition admonition-note aui-message warning shadowed information-macro\"> <p>It is important to choose Dev (512MB) and Small (256MB) containers wisely. We recommend the use of a Medium or larger container for MBS (formerly known as ArrowDB) apps. </p> </div> <p>If your application is archived, to reactivate the application, make a request to it. The first request will be slow, but subsequent requests will respond with normal speed. </p> <p>Note that each container your application runs on costs a certain number of points. To see how many points you have used and are allocated, or to see which containers your application is using, execute the <tt>appc cloud list</tt> command. </p> <div class=\"confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"defaultnew syntaxhighlighter scroll-html-formatted-code\"> <div class=\"line\"><code class=\"plain\">$ appc cloud list MyArrowApp</code></div> <div class=\"line\"><code class=\"plain\">ACS: Appcelerator Cloud Services Command-Line Interface, version </code><code class=\"value\">1.0</code><code class=\"plain\">.</code><code class=\"value\">23</code></div> <div class=\"line\"><code class=\"plain\">Copyright (c) </code><code class=\"value\">2012</code><code class=\"plain\">-</code><code class=\"value\">2015</code><code class=\"plain\">, Appcelerator, Inc. All Rights Reserved.</code></div> <div class=\"line\"><code class=\"plain\">Admin Hostname: https:</code><code class=\"comments\">//admin.cloudapp-enterprise-preprod.appctest.com</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">============ </code></div> <div class=\"line\"><code class=\"plain\">Points:</code></div> <div class=\"line\"><code class=\"plain\"> -- Quota: </code><code class=\"value\">17</code></div> <div class=\"line\"><code class=\"plain\"> -- Used: </code><code class=\"value\">16</code></div> <div class=\"line\">&#xA0;</div> <div class=\"line\"><code class=\"plain\">App name: MyArrowApp</code></div> <div class=\"line\"><code class=\"plain\"> -- Created by: joeuser</code><code class=\"color1\">@appcelerator</code><code class=\"plain\">.com</code></div> <div class=\"line\"><code class=\"plain\"> -- URL: https:</code><code class=\"comments\">//myapp.cloudapp-enterprise-preprod.appctest.com</code></div> <div class=\"line\"><code class=\"plain\"> -- Created at: Mon Mar </code><code class=\"value\">23</code><code class=\"plain\"> </code><code class=\"value\">2015</code><code class=\"plain\"> </code><code class=\"value\">21</code><code class=\"plain\">:</code><code class=\"value\">58</code><code class=\"plain\">:</code><code class=\"value\">36</code><code class=\"plain\"> GMT-</code><code class=\"value\">0700</code><code class=\"plain\"> (PDT)</code></div> <div class=\"line\"><code class=\"plain\"> -- Node Version: </code><code class=\"value\">0.10</code><code class=\"plain\">.</code><code class=\"value\">22</code></div> <div class=\"line\"><code class=\"plain\"> -- Server Size: XLarge</code></div> <div class=\"line\"><code class=\"plain\"> -- Maximum allowed number of servers: </code><code class=\"value\">1</code></div> <div class=\"line\"><code class=\"plain\"> -- Desired minimum number of servers: </code><code class=\"value\">1</code></div> <div class=\"line\"><code class=\"plain\"> -- Active version: </code><code class=\"value\">1.0</code><code class=\"plain\">.</code><code class=\"value\">0</code></div> <div class=\"line\"><code class=\"plain\"> -- Published at: Thu Mar </code><code class=\"value\">26</code><code class=\"plain\"> </code><code class=\"value\">2015</code><code class=\"plain\"> </code><code class=\"value\">13</code><code class=\"plain\">:</code><code class=\"value\">54</code><code class=\"plain\">:</code><code class=\"value\">07</code><code class=\"plain\"> GMT-</code><code class=\"value\">0700</code><code class=\"plain\"> (PDT)</code></div> <div class=\"line\"><code class=\"plain\"> -- Status: Deployed</code></div> </div> </div> </div> <div class=\"section section-3\" id=\"src-49153285_APIBuilderProject-Serverports\"> <h3 class=\"heading\"><span>Server ports</span></h3> <p>Currently, API Runtime Services only supports applications opening one server listening port. There cannot be more than one TCP/HTTP server started in one application. <span style=\"color: #222222;\"> </span> </p> </div> </div> </div><a id=\"editButton\" href=\"https://wiki.appcelerator.org/pages/editpage.action?pageId=49153285\"><span>Edit</span></a> </div> </body> </html> ","title":"API Builder Project"});