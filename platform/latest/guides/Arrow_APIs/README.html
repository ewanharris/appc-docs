<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Arrow APIs</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta content="Scroll EclipseHelp Exporter" name="generator"/>

    <link type="text/css" rel="stylesheet"/>
    <link type="text/css" rel="stylesheet"/>
    <link type="text/css" rel="stylesheet" media="print"/>
</head>
<body>
    <div class="container">
        <div class="header"/>

        <div id="43299002" class="content">
            <h1>Arrow APIs</h1>
    <p>
type (String): the type of input parameter: &lsquo;path&rsquo; or &lsquo;query&rsquo;    </p>
<ul class="toc-indentation "><li class=" ">    <p>
<a class="document-link " href="#!/guide/Arrow_APIs-section-43299002_ArrowAPIs-Introduction">Introduction</a>    </p>
</li><li class=" ">    <p>
<a class="document-link " href="#!/guide/Arrow_APIs-section-43299002_ArrowAPIs-APIEndpointDefinition">API Endpoint Definition</a>    </p>
</li><li class=" ">    <p>
<a class="document-link " href="#!/guide/Arrow_APIs-section-43299002_ArrowAPIs-APIExample">API Example</a>    </p>
</li><li class=" ">    <p>
<a class="document-link " href="#!/guide/Arrow_APIs-section-43299002_ArrowAPIs-InvokeAPIEndpointsinArrow">Invoke API Endpoints in Arrow</a>    </p>
</li></ul>    <div class="section section-2 " id="43299002_ArrowAPIs-Introduction">
        <h2 class="heading "><span>Introduction</span></h2>
    <p>
This guides covers the basics for creating API endpoints. API endpoints are automatically generated for all Arrow Models, but there may be cases where you will want to create your own custom API.    </p>
    <p>
An Arrow API provides a way for a client to access your application, such as <tt class=" ">GET &lt;SERVER_ADDRESS&gt;/api/users/query</tt>, execute custom logic and internally access the application's models and APIs, then return data back to the client application.    </p>
    <p>
To programatically create an API, see the <a class="external-link external-link" href="#!/api/Arrow.API">Arrow.API API reference</a>.    </p>
    </div>
    <div class="section section-2 " id="43299002_ArrowAPIs-APIEndpointDefinition">
        <h2 class="heading "><span>API Endpoint Definition</span></h2>
    <p>
Place all Arrow API definition files in the project's <tt class=" ">apis</tt> folder.  You can only declare one endpoint definition per file.  An Arrow API definition file is a JavaScript file, which:    </p>
<ol class=" "><li class=" ">    <p>
Loads the <tt class=" ">arrow</tt> module    </p>
</li><li class=" ">    <p>
Calls the module's <tt class=" ">API.extend()</tt> method, passing in an object defining the API endpoint and logic    </p>
</li><li class=" ">    <p>
Exports the defined endpoint using the <tt class=" ">module.exports</tt> variable    </p>
</li></ol>    <p>
Set the following keys in the object passed to the <tt class=" ">API.extend()</tt> method to define the API endpoint:    </p>
    <div class="tablewrap">
        <table class="confluenceTable">
        <thead class=" ">    <tr>
            <td class="confluenceTh" rowspan="1" colspan="1">
        <p>
Name    </p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
        <p>
Required    </p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
        <p>
Description    </p>
            </td>
        </tr>
</thead><tfoot class=" "/><tbody class=" ">    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
group    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
The logical name for grouping API endpoints.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
path    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
Request path (e.g., &lsquo;/api/user/:id&rsquo;). Prefix paramaters with a colon (<tt class=" ">:</tt>).    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
method    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
HTTP verb (&lsquo;GET&rsquo;, &lsquo;POST&rsquo;, &lsquo;PUT&rsquo;, or &lsquo;DELETE&rsquo;).    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
description    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
Description of the endpoint, which is used in the generation of the API endpoint documentation.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
model    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
The model to use for the response. An API endpoint can only specify <strong class=" ">one</strong> model, but model&rsquo;s can be composed of other models and fields.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
action    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
true    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
Function that is called to execute the API endpoint&rsquo;s logic. The function is passed a <tt class=" ">request</tt> object, response object and <tt class=" ">next()</tt> method. Use this function to make programmatic calls to your model&rsquo;s methods for reading or writing data and to do other things related to the custom business logic of your API endpoint including making calls to other node modules that your API endpoint requires.  You should always make sure that your <tt class=" ">action</tt> function calls the <tt class=" ">next</tt> function regardless if the result is a success or an error.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
documented    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
<strong class=" ">Since Release 5.0.0.</strong> Determines whether to generate API documentation (true) or not (false). Default is true.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
response    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
The response model for the API. This should only be used if your request and response models are different.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
plural    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
A string used as the property name when your API endpoint returns an array. By default, the plural value is the plural of the model name. For example, if your model is named <strong class=" ">car</strong>, the default plural would be <strong class=" ">cars</strong>.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
singular    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
A string used as the property name when your API endpoint returns a single record. By default, the singular value is the name of the model.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
before    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
One or more Arrow Blocks to be executed before the request. Blocks are referenced by their <tt class=" ">name</tt> property. If you want to execute multiple blocks, you should specify them as an array of block names. If multiple blocks are specified, they are executed in the order specified.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
after    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
One or more Arrow Blocks to be executed after the request. Blocks are referenced by their <tt class=" ">name</tt> property. If you want to execute multiple blocks, you should specify them as an array of block names. If multiple blocks are specified, they are executed in the order specified.    </p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
parameters    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
false    </p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <p>
Input parameters required to execute the API endpoint. This is an object of key-value pairs, where the key is the name of the parameter and the value is an object with the following properties:    </p>
<ul class=" "><li class=" ">    <p>
<tt class=" ">optional</tt> (Boolean): Determines if the parameter is optional (true) or required (false).    </p>
</li><li class=" ">    <p>
<tt class=" ">type</tt> (String): the type of input parameter: &lsquo;path&rsquo;, &lsquo;query&rsquo;, or 'body'.    </p>
</li><li class=" ">    <p>
<tt class=" ">description</tt> (String): used for generating API documentation.    </p>
</li></ul>            </td>
        </tr>
</tbody>        </table>
            </div>
    </div>
    <div class="section section-2 " id="43299002_ArrowAPIs-APIExample">
        <h2 class="heading "><span>API Example</span></h2>
    <p>
The following Arrow API definition file creates an endpoint that can be accesses by a client using <tt class=" ">GET &lt;HOST_ADDRESS&gt;/api/test/:id</tt>.  Before the request is initiated by the server, the <tt class=" ">formatRequestBlock</tt> is executed, then the server performs the request (executes the action logic).  The action logic tries to find the user model with the specified ID.  After the logic executes, the <tt class=" ">cachingBlock</tt> and <tt class=" ">analyticsBlocks</tt> are executed.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">apis/test.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var TestAPI = Arrow.API.extend({</code></div>
<div class="line"><code class="plain">    group: </code><code class="string">'test'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    path: </code><code class="string">'/api/test/:id'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    method: </code><code class="string">'GET'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    description: </code><code class="string">'this is an api that shows how to implement an API'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    model: </code><code class="string">'user'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    before: </code><code class="string">'formatRequestBlock'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    after: [</code><code class="string">'cachingBlock'</code><code class="plain">, </code><code class="string">'analyticsBlock'</code><code class="plain">],</code></div>
<div class="line"><code class="plain">    parameters: {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 'id' is required to execute this endpoint</code></div>
<div class="line"><code class="plain">        id: {description:</code><code class="string">'the user id'</code><code class="plain">}</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    action: function (req, res, next) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// call the 'find' method on our model to get the data passing the incoming path value id</code></div>
<div class="line"><code class="plain">        res.stream(req.model.find, req.params.id, next);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">module.exports = TestAPI;</code></div>
</div>
</div>    </div>
    <div class="section section-2 " id="43299002_ArrowAPIs-InvokeAPIEndpointsinArrow">
        <h2 class="heading "><span>Invoke API Endpoints in Arrow</span></h2>
    <p>
Any callback in the Arrow application that is passed the <tt class=" ">request</tt> object can access the Arrow API endpoints programmatically.    </p>
    <p>
To invoke an API endpoint:    </p>
<ol class=" "><li class=" ">    <p>
Retrieve an instance to Arrow using the <tt class=" ">request.server</tt> property.    </p>
</li><li class=" ">    <p>
Retrieve the Arrow API instance using Arrow's <tt class=" ">getAPI('endpoint', 'verb')</tt> method by passing it the endpoint without the server host or address as the first parameter and the HTTP verb as the second parameter.    </p>
</li><li class=" ">    <p>
Invoke the <tt class=" ">execute(params, callback)</tt> method on the Arrow API instance by passing it a dictionary of parameters as the first parameter and a callback function as the second parameter.  The callback function is passed an <tt class=" ">error</tt> and <tt class=" ">results</tt> object.    </p>
</li></ol>    <p>
<strong class=" ">Example:</strong>    </p>
    <p>
The Arrow Route below is invoking the <tt class=" ">GET &lt;SERVER_ADDRESS&gt;/api/car</tt> method programmatically.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">web/routes/testroute.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var TestRoute = Arrow.Router.extend({</code></div>
<div class="line"><code class="plain">    name: </code><code class="string">'car'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    path: </code><code class="string">'/car'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    method: </code><code class="string">'GET'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    description: </code><code class="string">'get some cars'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    action: function (req, res, next) {</code></div>
<div class="line"><code class="plain">        req.server.getAPI(</code><code class="string">'api/car'</code><code class="plain">, </code><code class="string">'GET'</code><code class="plain">).execute({}, function(err, results) {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">if</code><code class="plain"> (err) {</code></div>
<div class="line"><code class="plain">                next(err);</code></div>
<div class="line"><code class="plain">            } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">                req.log.info(</code><code class="string">'got cars '</code><code class="plain"> + JSON.stringify(results));</code></div>
<div class="line"><code class="plain">                res.render(</code><code class="string">'car'</code><code class="plain">, results);</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">module.exports = TestRoute;</code></div>
</div>
</div>    <p>
    </p>
    <p>
    </p>
    </div>
        </div><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=43299002"><span>Edit</span></a>
    
        <div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
    </div>
</body>
</html>
